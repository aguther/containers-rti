---
- name: "check deployed"
  stat:
    path: "{{ helm_bin_path }}"
  register: helm_check_deployed
  when: (inventory_hostname == groups['master'][0])

- include: deploy.yml
  when: (inventory_hostname == groups['master'][0])
        and not(helm_check_deployed.stat.exists)

- name: "check init"
  shell: "{{ helm_bin_path }} list"
  failed_when: no
  changed_when: no
  register: helm_check_init
  when: inventory_hostname == groups['master'][0]

- include: init.yml
  when: (inventory_hostname == groups['master'][0])
        and (helm_check_init.rc != 0)
