---
- name: install dashboard
  command: /usr/bin/kubectl --kubeconfig=/etc/kubernetes/admin.conf apply -f https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml
  register: dashboard_raw
  when: (inventory_hostname == groups['master'][0])

- set_fact:
    dashboard_output: "{{ dashboard_raw.stdout_lines }}"
  when: (inventory_hostname == groups['master'][0])

- debug:
    var: dashboard_output
  when: dashboard_output is defined

- name: create RBAC for dashboard
  command: /usr/bin/kubectl --kubeconfig=/etc/kubernetes/admin.conf create clusterrolebinding permissive-binding --clusterrole=cluster-admin --user=admin --user=kubelet --group=system:serviceaccounts
  register: rbac_raw
  ignore_errors: true
  when: (inventory_hostname == groups['master'][0])

- set_fact:
    rbac_output: "{{ rbac_raw.stdout_lines }}"

- debug:
    var: rbac_output
  when: rbac_output is defined
